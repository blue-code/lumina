<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lumina ‚ú® - Cosmic Interface</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="header-title">
                <h1>‚ú® Lumina</h1>
                <p>Cosmic API Client</p>
            </div>
            <div class="header-actions">
                <div class="project-selector">
                    <label for="project-dropdown" style="font-size: 0.8rem; color: var(--text-muted);">PROJECT:</label>
                    <select id="project-dropdown" class="project-dropdown">
                        <option value="">Loading...</option>
                    </select>
                    <button class="btn-icon" id="btn-new-project" title="Create new project">‚ûï</button>
                    <button class="btn-icon" id="btn-manage-projects" title="Manage projects">‚öôÔ∏è</button>
                </div>
                <a href="/docs" class="header-link" target="_blank">
                    <span>üìö</span> API Docs
                </a>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h3>Explorer</h3>
                <div class="sidebar-actions-row">
                    <button class="btn-neon" id="btn-new-request" style="flex: 1;">
                        + New Request
                    </button>
                </div>
                <div id="selected-folder-indicator" style="font-size: 0.75rem; color: var(--text-muted); margin-top: 0.5rem; padding: 0.3rem 0.5rem; background: rgba(255,255,255,0.03); border-radius: 4px; display: none;">
                    üìÇ Creating in: <span id="selected-folder-name">Root</span>
                </div>
            </div>
            
            <div class="sidebar-actions">
                <div class="sidebar-actions-row">
                    <button class="btn-glass" id="btn-new-folder" title="New Folder">
                        üìÅ New Folder
                    </button>
                </div>
                <div class="sidebar-actions-row">
                    <button class="btn-glass" id="btn-share-project" title="Share" style="flex: 1;">
                        üîó Share
                    </button>
                    <button class="btn-glass" id="btn-global-constants" title="Globals" style="flex: 1;">
                        üåê Globals
                    </button>
                    <button class="btn-more" id="btn-more" title="More options">
                        ‚ãÆ
                    </button>
                </div>
            </div>
            <!-- More Menu Dropdown -->
            <div class="more-menu hidden" id="more-menu">
                <div class="more-menu-item" id="menu-import-insomnia">
                    üì• Import from Insomnia
                </div>
                <div class="more-menu-item" id="menu-export-insomnia">
                    üì§ Export to Insomnia
                </div>
                <div class="more-menu-divider"></div>
                <div class="more-menu-item" id="menu-import-postman">
                    üì• Import from Postman
                </div>
                <div class="more-menu-item" id="menu-export-postman">
                    üì§ Export to Postman
                </div>
                <div class="more-menu-divider"></div>
                <div class="more-menu-item" id="menu-clear-all">
                    üóëÔ∏è Clear All Data
                </div>
            </div>

            <div class="folder-tree" id="folder-tree">
                <!-- Folder tree will be loaded here -->
            </div>
        </div>

        <!-- Sidebar Resizer -->
        <div class="resizer" id="resizer-sidebar"></div>

        <!-- Import Insomnia Modal -->
        <div class="modal" id="import-insomnia-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>üì• Import from Insomnia</h3>
                    <button class="modal-close" id="btn-close-import-insomnia">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="tab-help" style="margin-bottom: 1rem;">
                        üí° Select an Insomnia export JSON file.
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <input type="file" id="insomnia-import-file" accept=".json" class="glass-input" style="width: 100%; padding: 0.8rem; border-radius: 6px;">
                    </div>
                    <div id="import-insomnia-preview" style="display: none; margin-top: 1rem; padding: 1rem; background: rgba(255,255,255,0.05); border-radius: 6px;">
                        <p><strong>File:</strong> <span id="import-insomnia-filename"></span></p>
                        <p><strong>Project:</strong> <span id="import-insomnia-projectname"></span></p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn-cancel" id="btn-cancel-import-insomnia">Cancel</button>
                    <button class="btn-primary" id="btn-confirm-import-insomnia" disabled>Import as New Project</button>
                </div>
            </div>
        </div>

        <!-- Export Insomnia Modal -->
        <div class="modal" id="export-insomnia-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>üì§ Export to Insomnia</h3>
                    <button class="modal-close" id="btn-close-export-insomnia">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="tab-help" style="margin-bottom: 1rem;">
                        üí° Your API collection exported in Insomnia format. Copy or download.
                    </div>
                    <textarea id="export-insomnia-textarea" readonly style="width: 100%; min-height: 400px; max-height: 500px; background: rgba(0,0,0,0.3); border: 1px solid var(--glass-border); border-radius: 8px; padding: 1rem; color: var(--text-main); font-family: var(--font-mono); font-size: 0.875rem;"></textarea>
                </div>
                <div class="modal-footer">
                    <button class="btn-primary" id="btn-download-export-insomnia">üíæ Download</button>
                    <button class="btn-primary" id="btn-copy-export-insomnia">üìã Copy</button>
                    <button class="btn-cancel" id="btn-close-export-insomnia2">Close</button>
                </div>
            </div>
        </div>

        <!-- Import Postman Modal -->
        <div class="modal" id="import-postman-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>üì• Import from Postman</h3>
                    <button class="modal-close" id="btn-close-import-postman">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="tab-help" style="margin-bottom: 1rem;">
                        üí° Select a Postman Collection JSON file (v2.0 or v2.1).
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <input type="file" id="postman-import-file" accept=".json" class="glass-input" style="width: 100%; padding: 0.8rem; border-radius: 6px;">
                    </div>
                    <div id="import-postman-preview" style="display: none; margin-top: 1rem; padding: 1rem; background: rgba(255,255,255,0.05); border-radius: 6px;">
                        <p><strong>File:</strong> <span id="import-postman-filename"></span></p>
                        <p><strong>Collection:</strong> <span id="import-postman-collectionname"></span></p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn-cancel" id="btn-cancel-import-postman">Cancel</button>
                    <button class="btn-primary" id="btn-confirm-import-postman" disabled>Import as New Project</button>
                </div>
            </div>
        </div>

        <!-- Export Postman Modal -->
        <div class="modal" id="export-postman-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>üì§ Export to Postman</h3>
                    <button class="modal-close" id="btn-close-export-postman">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="tab-help" style="margin-bottom: 1rem;">
                        üí° Your API collection exported in Postman Collection v2.1 format. Copy or download.
                    </div>
                    <textarea id="export-postman-textarea" readonly style="width: 100%; min-height: 400px; max-height: 500px; background: rgba(0,0,0,0.3); border: 1px solid var(--glass-border); border-radius: 8px; padding: 1rem; color: var(--text-main); font-family: var(--font-mono); font-size: 0.875rem;"></textarea>
                </div>
                <div class="modal-footer">
                    <button class="btn-primary" id="btn-download-export-postman">üíæ Download</button>
                    <button class="btn-primary" id="btn-copy-export-postman">üìã Copy</button>
                    <button class="btn-cancel" id="btn-close-export-postman2">Close</button>
                </div>
            </div>
        </div>

        <!-- Request Editor -->
        <div class="request-editor">
                <div class="request-toolbar">
                    <div class="request-toolbar-actions">
                        <button class="btn-icon" id="btn-copy-url" title="Copy URL to clipboard">
                            üîó Copy URL
                        </button>
                        <button class="btn-icon btn-danger" id="btn-delete-request" title="Delete this request">
                            üóëÔ∏è Delete
                        </button>
                    </div>
                </div>
                <div class="request-header">
                    <select class="select-method" id="select-method">
                        <option value="GET">GET</option>
                        <option value="POST">POST</option>
                        <option value="PUT">PUT</option>
                        <option value="DELETE">DELETE</option>
                        <option value="PATCH">PATCH</option>
                        <option value="HEAD">HEAD</option>
                        <option value="OPTIONS">OPTIONS</option>
                    </select>
                    <input type="text" class="input-url" id="input-url" placeholder="https://api.example.com/v1/endpoint">
                    <button class="btn-send" id="btn-send">Send üöÄ</button>
                </div>

                <!-- Tabs -->
                <div class="tabs">
                    <button class="tab active" data-tab="params">Parameters</button>
                    <button class="tab" data-tab="headers">Headers</button>
                    <button class="tab" data-tab="body">Body</button>
                    <button class="tab" data-tab="auth">Auth</button>
                    <button class="tab" data-tab="docs">Docs</button>
                </div>

                <!-- Tab Contents -->
                <div class="tab-content active" id="tab-params">
                    <div style="margin-bottom: 1rem;">
                        <h4 style="margin-bottom: 0.5rem; color: var(--text-muted); font-size: 0.9rem;">Current Parameters</h4>
                        <table class="key-value-table">
                            <thead>
                                <tr>
                                    <th>Key</th>
                                    <th>Value</th>
                                    <th width="40"></th>
                                </tr>
                            </thead>
                            <tbody id="params-tbody">
                                <!-- Params will be loaded here -->
                            </tbody>
                        </table>
                    </div>

                    <div class="params-history-section" style="margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid var(--glass-border);">
                        <h4 style="margin-bottom: 0.5rem; color: var(--text-muted); font-size: 0.9rem;">Parameter History</h4>
                        <div id="params-history-list" class="history-list" style="max-height: 200px;">
                            <!-- Parameter history will be loaded here -->
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="tab-headers">
                    <table class="key-value-table">
                        <thead>
                            <tr>
                                <th>Key</th>
                                <th>Value</th>
                                <th width="40"></th>
                            </tr>
                        </thead>
                        <tbody id="headers-tbody">
                            <!-- Headers will be loaded here -->
                        </tbody>
                    </table>
                </div>

                <div class="tab-content" id="tab-body">
                    <div class="body-actions" style="margin-bottom: 1rem;">
                        <button class="btn-glass" id="btn-beautify-json">
                            ‚ú® Beautify JSON
                        </button>
                    </div>
                    <textarea id="body-raw" placeholder="{
  &quot;key&quot;: &quot;value&quot;
}"></textarea>
                </div>

                <div class="tab-content" id="tab-auth">
                    <div class="auth-container" style="max-width: 600px;">
                        <div class="form-group" style="margin-bottom: 1rem;">
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-muted);">Auth Type</label>
                            <select id="auth-type" class="select-method" style="width: 100%; text-align: left;">
                                <option value="none">No Auth</option>
                                <option value="basic">Basic Auth</option>
                                <option value="bearer">Bearer Token</option>
                                <option value="apikey">API Key</option>
                            </select>
                        </div>

                        <!-- Auth Fields (Hidden by default) -->
                        <div id="auth-basic" class="auth-section hidden">
                            <div class="form-group mb-1">
                                <input type="text" id="auth-basic-username" placeholder="Username" class="glass-input" style="width: 100%; padding: 0.8rem; border-radius: 6px; border: 1px solid var(--glass-border); background: rgba(255,255,255,0.05); color: white;">
                            </div>
                            <div class="form-group">
                                <input type="password" id="auth-basic-password" placeholder="Password" class="glass-input" style="width: 100%; padding: 0.8rem; border-radius: 6px; border: 1px solid var(--glass-border); background: rgba(255,255,255,0.05); color: white;">
                            </div>
                        </div>

                        <div id="auth-bearer" class="auth-section hidden">
                            <div class="form-group">
                                <input type="text" id="auth-bearer-token" placeholder="Bearer Token" class="glass-input" style="width: 100%; padding: 0.8rem; border-radius: 6px; border: 1px solid var(--glass-border); background: rgba(255,255,255,0.05); color: white;">
                            </div>
                        </div>

                        <div id="auth-apikey" class="auth-section hidden">
                            <div class="form-group mb-1">
                                <input type="text" id="auth-apikey-name" placeholder="Key Name (e.g. X-API-Key)" class="glass-input" style="width: 100%; padding: 0.8rem; border-radius: 6px; border: 1px solid var(--glass-border); background: rgba(255,255,255,0.05); color: white;">
                            </div>
                            <div class="form-group mb-1">
                                <input type="text" id="auth-apikey-value" placeholder="Key Value" class="glass-input" style="width: 100%; padding: 0.8rem; border-radius: 6px; border: 1px solid var(--glass-border); background: rgba(255,255,255,0.05); color: white;">
                            </div>
                            <div class="form-group">
                                <select id="auth-apikey-location" class="select-method" style="width: 100%; text-align: left;">
                                    <option value="header">Header</option>
                                    <option value="query">Query Params</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="tab-docs">
                    <div class="docs-preview-toggle" style="margin-bottom: 1rem;">
                        <button class="btn-glass" id="btn-toggle-preview">üëÅÔ∏è Toggle Preview</button>
                    </div>
                    <textarea id="docs-markdown" placeholder="# API Documentation"></textarea>
                    <div id="docs-preview" class="docs-preview hidden" style="padding: 1rem; background: rgba(255,255,255,0.05); border-radius: 8px;"></div>
                </div>
        </div>

        <!-- Resizer -->
        <div class="resizer" id="resizer"></div>

        <!-- Response Panel -->
        <div class="response-panel hidden" id="response-panel">
                <div class="response-header-section">
                    <div class="response-header-title" style="display: flex; align-items: center; gap: 1rem;">
                        <h3 style="margin: 0;">Response</h3>
                        <div class="response-status" id="response-status"></div>
                        <div class="response-meta" id="response-meta"></div>
                    </div>
                    <div class="response-header-actions">
                        <button class="btn-icon" id="btn-clear-response" title="Clear">üóëÔ∏è</button>
                    </div>
                </div>

                <!-- Response Tabs -->
                <div class="tabs">
                    <button class="response-tab active" data-tab="response">Response</button>
                    <button class="response-tab" data-tab="headers">Headers</button>
                    <button class="response-tab" data-tab="history">History</button>
                </div>

                <!-- Response Tab Contents -->
                <div class="response-tab-content active" id="response-tab-response">
                    <div class="response-body">
                        <pre id="response-body"></pre>
                    </div>
                </div>

                <div class="response-tab-content" id="response-tab-headers">
                    <div class="response-body" style="padding: 1rem;">
                        <table class="key-value-table">
                            <thead>
                                <tr>
                                    <th>Header</th>
                                    <th>Value</th>
                                </tr>
                            </thead>
                            <tbody id="response-headers-tbody">
                                <!-- Response headers will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="response-tab-content" id="response-tab-history">
                    <div class="response-body" style="padding: 1rem;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; height: 100%;">
                            <div>
                                <h4 style="margin-bottom: 0.5rem; color: var(--text-muted);">Request History</h4>
                                <div id="history-input-list" class="history-list">
                                    <!-- Request history will be loaded here -->
                                </div>
                            </div>
                            <div>
                                <h4 style="margin-bottom: 0.5rem; color: var(--text-muted);">Response History</h4>
                                <div id="history-output-list" class="history-list">
                                    <!-- Response history will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- New Project Modal -->
    <div class="modal" id="new-project-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚ûï Create New Project</h3>
                <button class="modal-close" id="btn-close-new-project">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="new-project-name">Project Name:</label>
                    <input type="text" id="new-project-name" placeholder="Enter project name..." class="glass-input" style="width: 100%; padding: 0.8rem; border-radius: 6px;">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" id="btn-cancel-new-project">Cancel</button>
                <button class="btn-primary" id="btn-confirm-new-project">Create</button>
            </div>
        </div>
    </div>

    <!-- Manage Projects Modal -->
    <div class="modal" id="manage-projects-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚öôÔ∏è Manage Projects</h3>
                <button class="modal-close" id="btn-close-manage-projects">&times;</button>
            </div>
            <div class="modal-body">
                <div class="tab-help" style="margin-bottom: 1rem;">
                    üí° Manage your projects. Double-click a project name to rename it.
                </div>
                <div class="projects-list" id="projects-list">
                    <!-- Projects will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" id="btn-close-manage-projects2">Close</button>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div class="modal" id="import-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Import Markdown</h3>
                <button class="modal-close" id="btn-close-import">&times;</button>
            </div>
            <div class="modal-body">
                <textarea id="import-markdown-textarea" placeholder="Paste Markdown here..."></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" id="btn-cancel-import">Cancel</button>
                <button class="btn-primary" id="btn-confirm-import">Import</button>
            </div>
        </div>
    </div>

    <!-- Share Modal -->
    <div class="modal" id="share-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üîó Share Project</h3>
                <button class="modal-close" id="btn-close-share">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; color: var(--text-muted);">Expires In:</label>
                    <select id="share-expires" class="select-method" style="width: 100%; text-align: left;">
                        <option value="">Never</option>
                        <option value="24">24 Hours</option>
                        <option value="168">7 Days</option>
                    </select>
                </div>
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; color: var(--text-muted);">
                        <input type="checkbox" id="share-readonly" checked> Read Only
                    </label>
                </div>
                <button class="btn-primary" id="btn-create-share" style="width: 100%;">Generate Link</button>
                <div id="share-url-container" style="display: none; margin-top: 1rem;">
                    <input type="text" id="share-url-input" readonly class="glass-input" style="width: 100%; padding: 0.8rem; border-radius: 6px;">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" id="btn-cancel-share">Cancel</button>
                <button class="btn-primary" id="btn-copy-share" style="display: none;">üìã Copy Link</button>
            </div>
        </div>
    </div>

    <!-- Import Share Modal -->
    <div class="modal" id="import-share-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üì• Import Shared Project</h3>
                <button class="modal-close" id="btn-close-import-share">&times;</button>
            </div>
            <div class="modal-body">
                <div class="tab-help" style="margin-bottom: 1rem;">
                    üí° Paste the share URL or ID below to import a shared project.
                </div>
                <input type="text" id="import-share-input" placeholder="Paste share URL or ID..." class="glass-input" style="width: 100%; padding: 0.8rem; border-radius: 6px;">
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" id="btn-cancel-import-share">Cancel</button>
                <button class="btn-primary" id="btn-confirm-import-share">Import Project</button>
            </div>
        </div>
    </div>

    <!-- Global Constants Modal -->
    <div class="modal" id="global-constants-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Global Constants</h3>
                <button class="modal-close" id="btn-close-global-constants">&times;</button>
            </div>
            <div class="modal-body">
                <table class="key-value-table">
                    <thead>
                        <tr>
                            <th>Key</th>
                            <th>Value</th>
                            <th width="40"><button class="btn-icon" id="btn-add-global-constant">+</button></th>
                        </tr>
                    </thead>
                    <tbody id="global-constants-tbody"></tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" id="btn-cancel-global-constants">Cancel</button>
                <button class="btn-primary" id="btn-save-global-constants">Save</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
